<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Budget Template</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Title of the budget sheet -->
    <header>
      <h1 id="budgetTitle">Loading...</h1>
        <h1> <span id="totalBalance1">+ $0.00</span></h1>
     
    </header>


     <!-- Buttons to Add Winnings, Spending -->
    <div class="add-buttons">
      <button id="addWinningsBtn" class="btn-primary">+ Winnings</button>
      <button id="addSpendingBtn" class="btn-secondary">- Spendings</button>
    </div>

    <!-- Transactions List -->
    <section id="transactions">
      <!-- Transactions will be populated here -->
    </section>
    
    <!-- Toggle Visibility of Limits and Progress Bars -->
    <button id="toggleLimitsBtn" class="btn-limit">Show Spending Limits</button>

    <!-- Progress Bars for Weekly, Monthly, and Yearly Limits (Initially hidden) -->
    <div id="limitSection" class="progress-bars hidden">
      <div>
        <p>Weekly Limit: <span id="weeklyLimitProgress">0%</span></p>
        <div class="progress-bar-container">
          <div id="weeklyProgressBar" class="progress-bar"></div>
        </div>
      </div>
      <div>
        <p>Monthly Limit: <span id="monthlyLimitProgress">0%</span></p>
        <div class="progress-bar-container">
          <div id="monthlyProgressBar" class="progress-bar"></div>
        </div>
      </div>
      <div>
        <p>Yearly Limit: <span id="yearlyLimitProgress">0%</span></p>
        <div class="progress-bar-container">
          <div id="yearlyProgressBar" class="progress-bar"></div>
        </div>
      </div>

      <!-- Button to Set Spending Limits -->
      <button id="setLimitBtn" class="btn-limit">Set Spending Limit</button>
    </div>
    
    <!-- Summary Section for Income, Expenses, and Balance -->
    <div class="summary-section">
      <p>Winnings <span id="totalIncome">+ $0.00</span></p>
      <p>Spendings <span id="totalExpenses">- $0.00</span></p>
      <p>Balance: <span id="totalBalance">+ $0.00</span></p>
    </div>

    <!-- Modal for Adding Transactions -->
    <div id="transactionModal" class="modal">
      <div class="modal-content">
        <h2 id="modalTitle">Add Transaction</h2>
        <label for="transactionAmount">Amount:</label>
        <input type="number" id="transactionAmount" required>
        <label for="transactionDate">Date:</label>
        <input type="date" id="transactionDate" required>
        <label for="transactionDetails">Details:</label>
        <input type="text" id="transactionDetails" required>
        <button id="saveTransactionBtn" class="btn-primary">Save</button>
        <button id="closeModal" class="btn-secondary">Close</button>
      </div>
    </div>

    <!-- Modal for Setting Spending Limit -->
    <div id="limitModal" class="modal">
      <div class="modal-content">
        <h2>Set Spending Limits</h2>
        <label for="weeklyLimit">Weekly Limit:</label>
        <input type="number" id="weeklyLimit" required>
        <label for="monthlyLimit">Monthly Limit:</label>
        <input type="number" id="monthlyLimit" required>
        <label for="yearlyLimit">Yearly Limit:</label>
        <input type="number" id="yearlyLimit" required>
        <button id="saveLimitBtn" class="btn-primary">Save Limits</button>
        <button id="closeLimitModal" class="btn-secondary">Close</button>
      </div>
    </div>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
      <button class="nav-item" id="navBudgets">
        <i class="icon-home"></i>
        <span>Budgets</span>
      </button>
      <button class="nav-item" id="navStarred">
        <i class="icon-star"></i>
        <span>Starred</span>
      </button>
      <button class="nav-item" id="navSettings">
        <i class="icon-settings"></i>
        <span>Settings</span>
      </button>
      <button class="nav-item" id="navAccount">
        <i class="icon-account"></i>
        <span>Account</span>
      </button>
    </nav>
  </div>

  <script>
    // Get the budget index from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const budgetIndex = urlParams.get('budgetIndex');

    // Retrieve the balance sheets and transactions from localStorage
    let balanceSheets = JSON.parse(localStorage.getItem('balanceSheets')) || [];
    let transactions = JSON.parse(localStorage.getItem('transactions')) || {};
    let spendingLimits = JSON.parse(localStorage.getItem('spendingLimits')) || { weekly: 0, monthly: 0, yearly: 0 };

    // Display the budget data
    if (budgetIndex !== null && balanceSheets[budgetIndex]) {
      const budget = balanceSheets[budgetIndex];
      document.getElementById('budgetTitle').textContent = budget.title;
      renderTransactions(budget.title);
      calculateSummary();
      updateProgressBars();
    } else {
      document.getElementById('budgetTitle').textContent = 'Budget Not Found';
    }

    // Function to render transactions
    function renderTransactions(budgetTitle) {
      const transactionsList = transactions[budgetTitle] || [];
      const transactionsContainer = document.getElementById('transactions');
      transactionsContainer.innerHTML = '';

      transactionsList.forEach((transaction) => {
        const transactionItem = document.createElement('div');
        transactionItem.classList.add('transaction-item');
        transactionItem.innerHTML = `
          <div>
            <p class="transaction-details">${transaction.details}</p>
            <p class="transaction-date">${transaction.date}</p>
          </div>
          <p class="transaction-amount ${transaction.type}">${transaction.type === 'income' ? '+' : '-'} $${transaction.amount.toFixed(2)}</p>
        `;
        transactionsContainer.appendChild(transactionItem);
      });
    }

    // Function to calculate and display income, expenses, and balance
    function calculateSummary() {
      const budgetTitle = balanceSheets[budgetIndex].title;
      const transactionsList = transactions[budgetTitle] || [];
      let totalIncome = 0;
      let totalExpenses = 0;

      transactionsList.forEach((transaction) => {
        if (transaction.type === 'income') {
          totalIncome += transaction.amount;
        } else {
          totalExpenses += transaction.amount;
        }
      });

      const totalBalance = totalIncome - totalExpenses;
      document.getElementById('totalIncome').textContent = `+ $${totalIncome.toFixed(2)}`;
      document.getElementById('totalExpenses').textContent = `- $${totalExpenses.toFixed(2)}`;
      document.getElementById('totalBalance').textContent = `${totalBalance >= 0 ? '+' : '-'} $${Math.abs(totalBalance).toFixed(2)}`;
      document.getElementById('totalBalance1').textContent = `${totalBalance >= 0 ? '+' : '-'} $${Math.abs(totalBalance).toFixed(2)}`;
    }

    // Open modal to add winnings or spending
    document.getElementById('addWinningsBtn').addEventListener('click', function () {
      document.getElementById('transactionModal').classList.add('active');
      document.getElementById('modalTitle').textContent = 'Add Winnings';
      document.getElementById('saveTransactionBtn').dataset.type = 'income';
    });

    document.getElementById('addSpendingBtn').addEventListener('click', function () {
      document.getElementById('transactionModal').classList.add('active');
      document.getElementById('modalTitle').textContent = 'Add Spending';
      document.getElementById('saveTransactionBtn').dataset.type = 'expense';
    });

    // Open modal to set limits
    document.getElementById('setLimitBtn').addEventListener('click', function () {
      document.getElementById('limitModal').classList.add('active');
    });

    // Save limits and update progress bars
    document.getElementById('saveLimitBtn').addEventListener('click', function () {
      const weeklyLimit = parseFloat(document.getElementById('weeklyLimit').value);
      const monthlyLimit = parseFloat(document.getElementById('monthlyLimit').value);
      const yearlyLimit = parseFloat(document.getElementById('yearlyLimit').value);

      spendingLimits = { weekly: weeklyLimit, monthly: monthlyLimit, yearly: yearlyLimit };
      localStorage.setItem('spendingLimits', JSON.stringify(spendingLimits));
      updateProgressBars();
      document.getElementById('limitModal').classList.remove('active');
    });

    // Function to update progress bars
    function updateProgressBars() {
      const budgetTitle = balanceSheets[budgetIndex].title;
      const transactionsList = transactions[budgetTitle] || [];
      let totalExpenses = 0;

      // Calculate total expenses
      transactionsList.forEach((transaction) => {
        if (transaction.type === 'expense') {
          totalExpenses += transaction.amount;
        }
      });

      // Calculate progress for weekly, monthly, and yearly limits
      const weeklyLimit = spendingLimits.weekly || 0;
      const monthlyLimit = spendingLimits.monthly || 0;
      const yearlyLimit = spendingLimits.yearly || 0;

      const weeklyProgress = weeklyLimit > 0 ? (totalExpenses / weeklyLimit) * 100 : 0;
      const monthlyProgress = monthlyLimit > 0 ? (totalExpenses / monthlyLimit) * 100 : 0;
      const yearlyProgress = yearlyLimit > 0 ? (totalExpenses / yearlyLimit) * 100 : 0;

      // Update weekly progress bar
      document.getElementById('weeklyLimitProgress').textContent = `${Math.min(weeklyProgress, 100).toFixed(0)}%`;
      document.getElementById('weeklyProgressBar').style.width = `${Math.min(weeklyProgress, 100)}%`;
      if (weeklyProgress >= 100) {
        document.getElementById('weeklyProgressBar').style.backgroundColor = 'red';
      } else if (weeklyProgress >= 75) {
        document.getElementById('weeklyProgressBar').style.backgroundColor = 'orange';
      } else if (weeklyProgress >= 50) {
        document.getElementById('weeklyProgressBar').style.backgroundColor = 'yellow';
      } else {
        document.getElementById('weeklyProgressBar').style.backgroundColor = 'green';
      }

      // Update monthly progress bar
      document.getElementById('monthlyLimitProgress').textContent = `${Math.min(monthlyProgress, 100).toFixed(0)}%`;
      document.getElementById('monthlyProgressBar').style.width = `${Math.min(monthlyProgress, 100)}%`;
      if (monthlyProgress >= 100) {
        document.getElementById('monthlyProgressBar').style.backgroundColor = 'red';
      } else if (monthlyProgress >= 75) {
        document.getElementById('monthlyProgressBar').style.backgroundColor = 'orange';
      } else if (monthlyProgress >= 50) {
        document.getElementById('monthlyProgressBar').style.backgroundColor = 'yellow';
      } else {
        document.getElementById('monthlyProgressBar').style.backgroundColor = 'green';
      }

      // Update yearly progress bar
      document.getElementById('yearlyLimitProgress').textContent = `${Math.min(yearlyProgress, 100).toFixed(0)}%`;
      document.getElementById('yearlyProgressBar').style.width = `${Math.min(yearlyProgress, 100)}%`;
      if (yearlyProgress >= 100) {
        document.getElementById('yearlyProgressBar').style.backgroundColor = 'red';
      } else if (yearlyProgress >= 75) {
        document.getElementById('yearlyProgressBar').style.backgroundColor = 'orange';
      } else if (yearlyProgress >= 50) {
        document.getElementById('yearlyProgressBar').style.backgroundColor = 'yellow';
      } else {
        document.getElementById('yearlyProgressBar').style.backgroundColor = 'green';
      }
    }

    // Toggle visibility of the limit section
    document.getElementById('toggleLimitsBtn').addEventListener('click', function () {
      const limitSection = document.getElementById('limitSection');
      const button = document.getElementById('toggleLimitsBtn');

      if (limitSection.classList.contains('hidden')) {
        limitSection.classList.remove('hidden');
        button.textContent = 'Hide Spending Limits';
      } else {
        limitSection.classList.add('hidden');
        button.textContent = 'Show Spending Limits';
      }
    });

    // Close transaction and limit modals
    document.getElementById('closeModal').addEventListener('click', function () {
      document.getElementById('transactionModal').classList.remove('active');
    });

    document.getElementById('closeLimitModal').addEventListener('click', function () {
      document.getElementById('limitModal').classList.remove('active');
    });

    // Save transaction
    document.getElementById('saveTransactionBtn').addEventListener('click', function () {
      const budgetTitle = balanceSheets[budgetIndex].title;
      const amount = parseFloat(document.getElementById('transactionAmount').value);
      const date = document.getElementById('transactionDate').value;
      const details = document.getElementById('transactionDetails').value;
      const type = document.getElementById('saveTransactionBtn').dataset.type;

      if (!amount || !date || !details) {
        alert('Please fill out all fields.');
        return;
      }

      const transaction = { amount, date, details, type };
      transactions[budgetTitle] = transactions[budgetTitle] || [];
      transactions[budgetTitle].push(transaction);
      localStorage.setItem('transactions', JSON.stringify(transactions));

      document.getElementById('transactionModal').classList.remove('active');
      renderTransactions(budgetTitle);
      calculateSummary();
      updateProgressBars(); // Recalculate and update progress bars after adding a transaction
    });

    // Initialize navigation buttons
    document.getElementById('navBudgets').addEventListener('click', function () {
      navigateTo('main.html');
    });
    document.getElementById('navStarred').addEventListener('click', function () {
      navigateTo('starred.html');
    });
    document.getElementById('navSettings').addEventListener('click', function () {
      navigateTo('settings.html');
    });
    document.getElementById('navAccount').addEventListener('click', function () {
      navigateTo('account.html');
    });

    function navigateTo(page) {
      window.location.href = page;
    }
  </script>
</body>
</html>
